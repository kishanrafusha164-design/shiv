<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Daily Stock Sheet</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f3f4f6;
    text-align: center;
    padding: 20px;
  }
  .card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: inline-block;
    width: 95%;
    max-width: 420px;
  }
  h2 { margin-bottom: 5px; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  input {
    width: 90%;
    padding: 6px;
    border-radius: 5px;
    border: 1px solid #bbb;
    text-align: center;
  }
  button {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    margin: 6px;
    font-weight: bold;
    cursor: pointer;
  }
  #saveBtn { background: #f59e0b; color: white; }
  #loadBtn { background: #3b82f6; color: white; }
  #whatsappBtn { background: #25D366; color: white; }
  #searchBar {
    width: 90%;
    padding: 8px;
    margin-top: 10px;
    font-size: 15px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<div class="card">
  <h2>ğŸ“¦ Auto Daily Stock Sheet</h2>
  <label>àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹:</label><br>
  <input type="date" id="date"><br>
  <input type="text" id="searchBar" placeholder="ğŸ” àªµàª¸à«àª¤à« àª¶à«‹àª§à«‹...">

  <table id="stockTable">
    <tr><th>Stock</th><th>Item</th><th>Auto</th></tr>
    <tr><td><input type="number"></td><td>àª²à«€àªŸàª°</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª¤àª¾àªœàª¾</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª›àª¾àª¸</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª àª¬à«àª¡àª¾</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª¦àª¹à«€</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª–àª¾àªŸà«€ àª›àª¾àª¸</td><td><input type="number"></td></tr>
    <tr><td><input type="number"></td><td>àª®àª¾àª–àª£</td><td><input type="number"></td></tr>
  </table>

  <button id="saveBtn" onclick="saveData()">ğŸ’¾ Save</button>
  <button id="loadBtn" onclick="loadData()">ğŸ“‚ Load</button>
  <button id="whatsappBtn" onclick="shareWhatsApp()">ğŸŸ¢ WhatsApp</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  databaseURL: "https://sheet-787b2-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);

// ğŸ“… Auto-select today's date
window.onload = () => {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById("date").value = today;
};

// ğŸ” Search filter
document.getElementById("searchBar").addEventListener("keyup", function() {
  const filter = this.value.toLowerCase();
  const rows = document.querySelectorAll("#stockTable tr");
  rows.forEach((row, index) => {
    if (index === 0) return;
    const item = row.querySelector("td:nth-child(2)").innerText.toLowerCase();
    row.style.display = item.includes(filter) ? "" : "none";
  });
});

// ğŸ’¾ Save data to Firebase
function saveData() {
  const date = document.getElementById("date").value;
  if (!date) return alert("àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹!");

  const rows = document.querySelectorAll("#stockTable tr");
  const data = [];
  rows.forEach((row, i) => {
    if (i === 0) return;
    const name = row.querySelector("td:nth-child(2)").innerText.trim();
    const inputs = row.querySelectorAll("input");
    const stock = inputs[0].value || "0";
    const auto = inputs[1].value || "0";
    data.push({ name, stock, auto });
  });

  firebase.database().ref("stockData/" + date).set(data);
  alert("âœ… àª¡à«‡àªŸàª¾ àª¸àª¾àªšàªµàª¾àª¯à«‹!");
}

// ğŸ“‚ Load data from Firebase
function loadData() {
  const date = document.getElementById("date").value;
  if (!date) return alert("àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹!");

  firebase.database().ref("stockData/" + date).once("value").then(snapshot => {
    const data = snapshot.val();
    if (!data) return alert("âŒ àª† àª¤àª¾àª°à«€àª– àª®àª¾àªŸà«‡ àª•à«‹àªˆ àª¡à«‡àªŸàª¾ àª¨àª¥à«€!");
    const rows = document.querySelectorAll("#stockTable tr");
    data.forEach((item, i) => {
      const inputs = rows[i + 1].querySelectorAll("input");
      inputs[0].value = item.stock;
      inputs[1].value = item.auto;
    });
    alert("ğŸ“‚ àª¡à«‡àªŸàª¾ àª²à«‹àª¡ àª¥àª¯à«‹!");
  });
}

// ğŸŸ¢ WhatsApp share
function shareWhatsApp() {
  const date = document.getElementById("date").value || "N/A";
  let message = `ğŸ“¦ *Auto Daily Stock Sheet* (${date})\n\n`;
  message += `Stock | Item Name | Auto\n`;
  message += `---------------------------\n`;

  const rows = document.querySelectorAll("#stockTable tr");
  let totalStock = 0, totalAuto = 0;
  rows.forEach((row, i) => {
    if (i === 0 || row.style.display === "none") return;
    const name = row.querySelector("td:nth-child(2)").innerText.trim();
    const inputs = row.querySelectorAll("input");
    const stock = parseFloat(inputs[0].value) || 0;
    const auto = parseFloat(inputs[1].value) || 0;
    totalStock += stock;
    totalAuto += auto;
    message += `${stock} | ${name} | ${auto}\n`;
  });
  message += `---------------------------\n`;
  message += `Total: ${totalStock} | àª•à«àª² | ${totalAuto}\n`;

  const url = "https://wa.me/?text=" + encodeURIComponent(message);
  window.open(url, "_blank");
}
</script>
</body>
</html>