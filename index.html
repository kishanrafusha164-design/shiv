<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Daily Stock Sheet</title>
<style>
  body { font-family: Arial; text-align: center; margin: 20px; background: #fafafa; }
  table { margin: 10px auto; border-collapse: collapse; width: 90%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #fff4c2; }
  input[type=number], input[type=text] { width: 80px; text-align: center; }
  button { margin: 8px; padding: 8px 15px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
  #saveBtn { background-color: orange; }
  #copyBtn { background-color: dodgerblue; }
  #shareBtn { background-color: green; }
  #pdfBtn { background-color: #555; }
  #status { font-weight: bold; color: #444; margin-top: 10px; }
</style>
</head>
<body>

<h2>ğŸ“… Auto Daily Stock Sheet</h2>

<label>Select Date:</label>
<input type="date" id="dateInput"><br><br>

<table id="stockTable">
  <tr><th>Stock</th><th>Item Name</th><th>Auto</th></tr>
  <tr><td><input type="number" value="9"></td><td>àª²à«€àªŸàª°</td><td><input type="number" value="10"></td></tr>
  <tr><td><input type="number" value="20"></td><td>àª¤àª¾àªœàª¾</td><td><input type="number" value="10"></td></tr>
  <tr><td><input type="number" value="10"></td><td>àª›àª¾àª¸</td><td><input type="number" value="8"></td></tr>
  <tr><td><input type="number" value="20"></td><td>àª àª¬à«àª¡àª¾</td><td><input type="number" value="50"></td></tr>
  <tr><td><input type="number" value="10"></td><td>àª¦àª¹à«€</td><td><input type="number" value="20"></td></tr>
  <tr><td><input type="number" value="2"></td><td>àª–àª¾àªŸà«€ àª›àª¾àª¸</td><td><input type="number" value="5"></td></tr>
  <tr><td><input type="number" value="0"></td><td>àª®àª¾àª–àª£</td><td><input type="number" value="0"></td></tr>
</table>

<button id="saveBtn" onclick="saveData()">ğŸ’¾ Save</button>
<button id="copyBtn" onclick="copyAll()">ğŸ“‹ Copy All</button>
<button id="shareBtn" onclick="shareWhatsApp()">ğŸ’¬ Share WhatsApp</button>
<button id="pdfBtn" onclick="generatePDF()">ğŸ–¨ï¸ PDF / Print</button>

<p id="status"></p>

<script type="module">
  // Firebase setup
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    databaseURL: "https://sheet-787b2-default-rtdb.asia-southeast1.firebasedatabase.app/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Auto load when date selected
  document.getElementById("dateInput").addEventListener("change", loadData);

  async function loadData() {
    const date = document.getElementById("dateInput").value;
    if (!date) return;
    document.getElementById("status").innerText = "â³ Loading data...";
    try {
      const snapshot = await get(child(ref(db), "stocks/" + date));
      if (snapshot.exists()) {
        const data = snapshot.val();
        const rows = document.querySelectorAll("#stockTable tr");
        data.forEach((item, i) => {
          if (i + 1 < rows.length) {
            rows[i + 1].children[0].children[0].value = item.stock;
            rows[i + 1].children[2].children[0].value = item.auto;
          }
        });
        document.getElementById("status").innerText = `âœ… Loaded data for ${date}`;
      } else {
        document.getElementById("status").innerText = "â„¹ï¸ No data found, you can enter new values.";
      }
    } catch (err) {
      document.getElementById("status").innerText = "âŒ Error loading data!";
      console.error(err);
    }
  }

  // Save data to Firebase
  window.saveData = async function() {
    const date = document.getElementById("dateInput").value;
    if (!date) return alert("àªªàª¹à«‡àª²àª¾àª‚ àª¤àª¾àª°à«€àª– àªªàª¸àª‚àª¦ àª•àª°à«‹!");

    const rows = document.querySelectorAll("#stockTable tr");
    const data = [];
    rows.forEach((r, i) => {
      if (i === 0) return;
      const stock = r.children[0].children[0].value;
      const name = r.children[1].innerText;
      const auto = r.children[2].children[0].value;
      data.push({ stock, name, auto });
    });

    await set(ref(db, "stocks/" + date), data);
    document.getElementById("status").innerText = `âœ… Saved data for ${date}`;
  };

  // Copy all data
  window.copyAll = function() {
    let text = "ğŸ“‹ Auto Daily Stock Sheet\n\n";
    const rows = document.querySelectorAll("#stockTable tr");
    rows.forEach((r, i) => {
      if (i === 0) return;
      const stock = r.children[0].children[0].value;
      const name = r.children[1].innerText;
      const auto = r.children[2].children[0].value;
      text += `${name}: ${stock} / ${auto}\n`;
    });
    navigator.clipboard.writeText(text);
    alert("âœ… Data copied!");
  };

  // Share via WhatsApp
  window.shareWhatsApp = function() {
    let msg = "ğŸ“¦ *Auto Daily Stock Sheet*\n";
    const date = document.getElementById("dateInput").value;
    msg += `ğŸ“… Date: ${date}\n\n`;
    const rows = document.querySelectorAll("#stockTable tr");
    rows.forEach((r, i) => {
      if (i === 0) return;
      const name = r.children[1].innerText;
      const auto = r.children[2].children[0].value;
      msg += `â€¢ ${name}: ${auto}\n`;
    });
    window.open("https://wa.me/?text=" + encodeURIComponent(msg), "_blank");
  };

  // Generate PDF / Print
  window.generatePDF = function() {
    const date = document.getElementById("dateInput").value;
    const printContent = document.getElementById("stockTable").outerHTML;
    const w = window.open();
    w.document.write(`<html><head><title>PDF - ${date}</title></head><body>`);
    w.document.write(`<h2>Auto Daily Stock Sheet (${date})</h2>`);
    w.document.write(printContent);
    w.document.write("</body></html>");
    w.print();
    w.close();
  };
</script>

</body>
</html>